/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a){var b,c,d;typeof window=="undefined"||typeof require=="function"?($=require("jquery"),b=require("underscore"),c=require("backbone"),d=c,module&&(module.exports=d)):($=this.$,b=this._,c=this.Backbone,d=this),c.sync=function(a,d,e){var f=function(a){if(e&&e.url)return b.result(e,"url")||urlError();if(a&&a.url)return b.result(a,"url")||urlError();urlError()},g=f(d).split("/"),h=g[0]!==""?g[0]:g[1],i=b.extend({req:h+":"+a},e);!i.data&&d&&(i.data=d.toJSON(e)||{});var j=d.socket||window.socket||c.socket,k=e.success;e.success=function(a){k&&k(d,a,e),d.trigger("sync",d,a,e)};var l=e.error;e.error=function(a){l&&l(d,a,e),d.trigger("error",d,a,e)};var m=$.Deferred();return j.emit(h+":"+a,i.data,function(a,b){a?(e.error(a),m.reject()):(e.success(b),m.resolve())}),promise=m.promise(),d.trigger("request",d,promise,e),promise}})()