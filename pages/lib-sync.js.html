<h2>lib/sync.js</h2><div id="comments"><div class="comment"><h3>Backbone.sync()</h3><div class="summary"><h1>Backbone.sync</h1></div><ul class="tags"></ul><div class="body"><p>Replaces default Backbone.sync function with socket.io transport</p>

<h3>Assumptions</h3>

<p>Currently expects active socket to be located at <code>window.socket</code> <br />or <code>Backbone.socket</code>. See inline comments if you want to change it.</p>

<h3>Server Side</h3>

<pre><code>socket.on('todos:create', function (data, fn) {
 ...
 fn(null, todo);
});
socket.on('todos:read', ... );
socket.on('todos:update', ... );
socket.on('todos:delete', ... );
</code></pre></div><a href="#" class="button view-source">view source</a><pre class="source"><code>Backbone.sync = function (method, model, options) {
  var getUrl = function (object) {
    if (!(object && object.url)) return null;
    return _.isFunction(object.url) ? object.url() : object.url;
  };

  var cmd = getUrl(model).split('/'),
      namespace = cmd[0];

  var params = _.extend({
    req: namespace + ':' + method
  }, options);

  params.data = model.toJSON() || {};
  
  // If your socket.io connection exists on a different var, change here: 
  var io = window.socket || Backbone.socket;

  io.emit(namespace + ':' + method, params.data, function (err, data) {
    if (err) {
      options.error(err);
    } else {
      options.success(data);
    }
  });
};</code></pre></div></div>