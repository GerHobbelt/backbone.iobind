/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

Backbone.Model.prototype.ioBindVersion="0.2.4",Backbone.Model.prototype.ioBind=function(a,b,c,d){var e=this._ioEvents||(this._ioEvents={}),f=this.url()+":"+a,g=this;"function"==typeof b&&(d=c,c=b,b=window.socket||Backbone.socket);var h={name:a,global:f,cbLocal:c,cbGlobal:function(b){g.trigger(a,b)}};return this.bind(h.name,h.cbLocal,d||g),b.on(h.global,h.cbGlobal),e[h.name]?e[h.name].push(h):e[h.name]=[h],this},Backbone.Model.prototype.ioUnbind=function(a,b,c){var d=this._ioEvents||(this._ioEvents={}),e=this.url()+":"+a,f=this;"function"==typeof b&&(c=b,b=window.socket||Backbone.socket);var g=d[a];if(!_.isEmpty(g)){if(c&&"function"==typeof c){for(var h=0,i=g.length;h<i;h++)c==g[h].cbLocal&&(this.unbind(g[h].name,g[h].cbLocal),b.removeListener(g[h].global,g[h].cbGlobal),g[h]=!1);g=_.compact(g)}else this.unbind(a),b.removeAllListeners(e);g.length===0&&delete d[a]}return this},Backbone.Model.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=window.socket||Backbone.socket);for(var c in b)this.ioUnbind(c,a);return this}Backbone.Collection.prototype.ioBindVersion="0.2.4",Backbone.Collection.prototype.ioBind=function(a,b,c,d){var e=this._ioEvents||(this._ioEvents={}),f=this.url+":"+a,g=this;"function"==typeof b&&(d=c,c=b,b=window.socket||Backbone.socket);var h={name:a,global:f,cbLocal:c,cbGlobal:function(b){g.trigger(a,b)}};return this.bind(h.name,h.cbLocal,d),b.on(h.global,h.cbGlobal),e[h.name]?e[h.name].push(h):e[h.name]=[h],this},Backbone.Collection.prototype.ioUnbind=function(a,b,c){var d=this._ioEvents||(this._ioEvents={}),e=this.url+":"+a,f=this;"function"==typeof b&&(c=b,b=window.socket||Backbone.socket);var g=d[a];if(!_.isEmpty(g)){if(c&&"function"==typeof c){for(var h=0,i=g.length;h<i;h++)c==g[h].cbLocal&&(this.unbind(g[h].name,g[h].cbLocal),b.removeListener(g[h].global,g[h].cbGlobal),g[h]=!1);g=_.compact(g)}else this.unbind(a),b.removeAllListeners(e);g.length===0&&delete d[a]}return this},Backbone.Collection.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=window.socket||Backbone.socket);for(var c in b)this.ioUnbind(c,a);return this}