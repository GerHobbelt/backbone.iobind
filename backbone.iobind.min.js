/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a){var b,c,d;typeof window=="undefined"?(b=require("underscore"),c=require("backbone"),d=module.exports=c):(b=this._,c=this.Backbone,d=this),c.Model.prototype.ioBindVersion="0.3.1",c.Model.prototype.ioBind=function(a,b,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url()+":"+a,h=this;"function"==typeof b&&(e=d,d=b,b=this.socket||window.socket||c.socket);var i={name:a,global:g,cbLocal:d,cbGlobal:function(b){h.trigger(a,b)}};return this.bind(i.name,i.cbLocal,e||h),b.on(i.global,i.cbGlobal),f[i.name]?f[i.name].push(i):f[i.name]=[i],this},c.Model.prototype.ioUnbind=function(a,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url()+":"+a,h=this;"function"==typeof d&&(e=d,d=this.socket||window.socket||c.socket);var i=f[a];if(!b.isEmpty(i)){if(e&&"function"==typeof e){for(var j=0,k=i.length;j<k;j++)e==i[j].cbLocal&&(this.unbind(i[j].name,i[j].cbLocal),d.removeListener(i[j].global,i[j].cbGlobal),i[j]=!1);i=b.compact(i)}else this.unbind(a),d.removeAllListeners(g);i.length===0&&delete f[a]}return this},c.Model.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=this.socket||window.socket||c.socket);for(var d in b)this.ioUnbind(d,a);return this}})()(function(a){var b,c,d;typeof window=="undefined"?(b=require("underscore"),c=require("backbone"),d=module.exports=c):(b=this._,c=this.Backbone,d=this),c.Collection.prototype.ioBindVersion="0.3.1",c.Collection.prototype.ioBind=function(a,b,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url+":"+a,h=this;"function"==typeof b&&(e=d,d=b,b=this.socket||window.socket||c.socket);var i={name:a,global:g,cbLocal:d,cbGlobal:function(b){h.trigger(a,b)}};return this.bind(i.name,i.cbLocal,e),b.on(i.global,i.cbGlobal),f[i.name]?f[i.name].push(i):f[i.name]=[i],this},c.Collection.prototype.ioUnbind=function(a,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url+":"+a,h=this;"function"==typeof d&&(e=d,d=this.socket||window.socket||c.socket);var i=f[a];if(!b.isEmpty(i)){if(e&&"function"==typeof e){for(var j=0,k=i.length;j<k;j++)e==i[j].cbLocal&&(this.unbind(i[j].name,i[j].cbLocal),d.removeListener(i[j].global,i[j].cbGlobal),i[j]=!1);i=b.compact(i)}else this.unbind(a),d.removeAllListeners(g);i.length===0&&delete f[a]}return this},c.Collection.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=this.socket||window.socket||c.socket);for(var d in b)this.ioUnbind(d,a);return this}})()